<!DOCTYPE html>
<html>
    <head><title>Terminal Sample</title></head>
    <body>
        <!--Include the retrolib web bundle.-->
        <script src="../../../dist/retrolib.js"></script>
        <script>
            retrolib.setCanvasBackground('black')
            retrolib.initialize('gamecanvas', 720, 400, true, true)
            let ctx = retrolib.gameCanvas.getContext('2d')
            
            var playerX = 5
            var playerY = 5

            retrolib.terminal.Initialize()

            retrolib.map.Initialize(60, 19)
            
            const block = { name: 'block', group: 'block', colors: [{ r: 255, g: 255, b: 255, a: 255}], bgColor: null, characters: ['#'], blockVision: true, blockMovement: true }
            retrolib.map.setCell({ x: 5, y: 4, cellType: block, light: 0 })
            retrolib.map.setCell({ x: 6, y: 4, cellType: block, light: 0 })
            retrolib.map.setCell({ x: 3, y: 3, cellType: block, light: 0 })
            retrolib.map.setCell({ x: 4, y: 3, cellType: block, light: 0 })
            retrolib.map.setCell({ x: 4, y: 4, cellType: block, light: 0 })
            retrolib.map.setCell({ x: 5, y: 2, cellType: block, light: 0 })
            retrolib.map.setCell({ x: 6, y: 2, cellType: block, light: 0 })

            function drawPlayer() {            
                retrolib.terminal.clear()
                let cells = retrolib.map.fov(4.5, playerX, playerY, [])
                cells.forEach((mapCell) => {
                    retrolib.terminal.setCell(mapCell.x, mapCell.y,
                        mapCell.cellType.characters[0],
                        mapCell.cellType.colors[0],
                        mapCell.cellType.bgColor)
                })
    
                retrolib.terminal.setCell(playerX, playerY, '@', { r: 255, g: 255, b: 0, a: 255 }, { r: 0, g: 0, b: 255, a: 255 })
            }
           
            drawPlayer()
            
            const scene = retrolib.scenes.addScene(new retrolib.Scene('hello world', (delta) => {
                retrolib.terminal.Draw()                
            }, true, undefined, undefined, (inputName, amt, released) => {
                if (!released) {
                    return
                }
                if (inputName === 'left') {
                    playerX--
                    if (playerX < 0) {
                        playerX = 0
                    }
                    drawPlayer()
                }
                if (inputName === 'right') {
                    playerX++
                    if (playerX > retrolib.map.width) {
                        playerX = retrolib.map.width - 1
                    }
                    drawPlayer()
                }
                if (inputName === 'up') {
                    playerY--
                    if (playerY < 0) {
                        playerY = 0
                    }
                    drawPlayer()
                }
                if (inputName === 'down') {
                    playerY++
                    if (playerY > retrolib.map.height) {
                        playerY = retrolib.map.height - 1
                    }
                    drawPlayer()
                }
            }))

        </script>
    </body>
</html>